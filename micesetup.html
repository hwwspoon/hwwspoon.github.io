<HTML>

<HEAD>
<META NAME="robots" CONTENT="INDEX,FOLLOW">
<TITLE>Setting up MICE</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="mystyle.css">
</HEAD>

<BODY BACKGROUND="./pics/bg.jpg" TEXT="#000000" LINK="#000000" VLINK="#000000" ALINK="#000000">
<CENTER>[ <A HREF="index.html">home</A> | <A HREF="research.html">research</A>
        | <A HREF="personal.html">personal</A> | <A HREF="resume.html">resume</A>
        | <A HREF="links.html">links</A> ]</CENTER>
<BR>

<CENTER>
<H2>Setting up MICE</H2>
(last modified in 2002)
</CENTER>

<H3>Required operating system</H3>
The current version of MICE has been written in IDL (versions&gt;5) for 
UNIX and LINUX operating systems. 

<H3>Installing MICE</H3>
Create a <B>mice</B> directory with subdirectories <B>tables</B>, <B>seds</B> 
and <B>routines</B>. Now download, g-unzip and un-tar the three files with
the contents for the subdirectories
<A HREF="./mice/tables.tar.gz"><B>tables</B></A>, 
<A HREF="seds.html"><B>seds</B></A> 
and <A HREF="./mice/routines.tar.gz"><B>routines</B></A>.
<BR>
Define an environment variable <B>MICE_TOP</B> in your 
<B>.login</B> file, pointing to the <B>mice</B> directory. Example:
<B>setenv MICE_TOP /home/hspoon/mice</B>.
<BR>
Now adapt the predefined paths to tables and source codes in file
<B>mice_file_table.pro</B>.

<H3></H3>


<H3>Creating the MICE color tables</H3>
The MICE plotting routines take their colors from a special color table;
either <B>mice.colortable</B> or <B>mice.greytable</B>. These color
tables can be created upon installation of MICE by typing:
<BR>
<B>IDL>create_mice_colortable</B>
<BR>
<B>IDL>create_mice_greytable</B>
<BR>
The two tables should be placed into the <B>tables</B> subdirectory.

<BR><BR>
In order to correctly load one of these color tables, your <B>startup.idl</B>
file should be appended with the following line:
<BR>
<B>WINDOW,COLORS=200,/PIXMAP & WDELETE</B>
<BR>
This ensures that IDL can reserve 200 colours. A larger number of
reserved colors is also acceptable. MICE will however only use the
first 200 then. 

<BR><BR>
To test whether the color table is installed correctly type:
<BR>
<B>IDL>micecol</B>
<BR>
<B>IDL>plot_mice_colortable</B>
<BR>
and compare the result to  <A HREF="./mice/mice_colortable.jpg">this</A> plot.


<H3>Installing Cloudy for MICE: currently C96 beta-4</H3>
Create a <B>cloudy</B> home directory with subdirectories <B>source</B> 
and <B>data</B> and 
<A HREF="http://www.nublado.org/c96/c96b4_save/c96_downloads.htm">download</A>
the two gzipped tar files that the Cloudy C96B4 distribution consists of. 
Put the two files in their respective subdirectory (<B>source</B> and 
<B>data</B>) and g-unzip and un-tar them there.
<BR>
Incorporate all 
<A HREF="http://www.nublado.org/c96/c96b4_save/c96_hotfixes.htm">"hot fixes"</A>
known for the current version of Cloudy. Give variable <B>npunlm</B> in 
file <B>punlin.c</B> the value 1500L. Finally, follow the 
<A HREF="http://www.nublado.org/c96/c96b4_save/c96_edit_path.htm">recipe</A> 
to edit the path in file <B>path.c</B> to point to the Cloudy <B>data</B> 
subdirectory. 
<BR><BR>
For Sun Solaris the Cloudy executable is generated by typing:
<BR>
<B>cc -Xc -lm -fast -c *.c</B>
<BR>
<B>cc -fast -o cloudy.exe *.o -lm</B>
<BR><BR>
For Linux the Cloudy executable is generated by typing:          
<BR>
<B>gcc -ansi -c -O3 -ffast-math -Wall *.c</B>
<BR>
<B>gcc -ffast-math -o cloudy.exe *.o -lm</B>
<BR>
If you have installed gcc version 2.96 (check by typing <B>gcc -v</B>), 
use kgcc instead. Details regarding the compilation can be found
<A HREF="http://www.nublado.org/c96/c96b4_save/c96_compiling.htm">here</A>.
<BR><BR>
Now make sure that the path to the Cloudy executable in MICE file
<B>mice_file_table.pro</B> points to the right directory.

<H3>Installing STOREY for MICE</H3>
Create a <B>storey</B> home directory. Download the Fortran code 
<A HREF="./mice/storey.for"><B>storey.for</B></A> and the accompanying
data file <A HREF="./mice/e1b.d"><B>e1b.d</B></A>. The code computes
hydrogen recombination line strengths for a given electron density and
electron temperature 
(<A HREF="./mice/mnras_272_41.pdf">Storey & Hummer 1995</A>).<BR>
In <B>storey.for</B>, change on line 123 the path to file <B>e1b.d</B> 
to point to the <B>storey</B> directory. <BR>
The <B>storey</B> code can now be compiled using the following command:<BR>
<B>gfortran storey.for -o storey.exe</B><BR>
Now make sure that the path to the Storey executable in MICE file
<B>mice_file_table.pro</B> points to the right directory.

<H3>Test the MICE setup</H3>
In order to find out whether you set up MICE correctly, you should 
download the <A HREF="./mice/mice.test.input"><B>mice.test.input</B></A> file
and go through the following steps:
<OL>
<LI>At the IDL prompt type:<BR>
    <B>IDL>make_cloudin,'mice.test.input',nzones=1,/NoCleanUp</B><BR>
    This command should produce four new files in your working directory:<BR>
    <B>cloudy.sequence</B>, <B>mice.sequence</B>, <B>mice.griddef.xdr</B> and 
    <B>intern_s1.in</B></LI>
<LI>At the UNIX/LINUX prompt you can start the Cloudy computation with the 
    following command:<BR>
    <B>LINUX>./cloudy.sequence</B><BR>
    If Cloudy has been installed correctly, the computation will produce the 
    following output files: <B>intern_s1.main</B>, <B>intern_s1.flux1</B>, 
    <B>intern_s1.flux2</B>, <B>intern_s1.cont1</B>, <B>intern_s1.cont2</B> 
    and <B>intern_s1.geom</B>.</LI> 
<LI>At the IDL prompt you can start reading in the Cloudy results into MICE 
with the following command:<BR>
<B>IDL>@mice.sequence</B><BR>
If MICE has been installed correctly (paths in <B>mice_file_table.pro</B> 
set correctly?), this produces an IDL XDR file named 
<B>res.save</B></LI>
<LI>At the IDL prompt now type:<BR>
<B>IDL>micewin</B><BR> 
to create the MICE plotting window.</LI>
<LI>Followed by:<BR>
<B>IDL>micecol</B><BR>
to load the MICE color table.</LI>
<LI>The test run finishes by plotting the line strengths of several
tens of forbidden lines on screen:<BR>
<B>IDL>plot_linespec,res</B><BR>
Your MICE plotting window should display <A HREF="./pics/linespec.jpg">this</A>.</LI>
If the colors do not match, your computer has difficulties assigning the MICE colors.
I don't know any solution to this problem <A HREF="mailto:spoon@astro.rug.nl">yet</A>.
</OL>

<H3>Get the MICE input template</H3>
I recommend to download my template <A HREF="./mice/mice.input"><B>mice.input</B></A>
file. I always start from this file when I want to define a MICE grid.

</BODY>
</HTML>


